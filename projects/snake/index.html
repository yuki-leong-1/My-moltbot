<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>ğŸ è´ªåƒè›‡</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0f0f23;display:flex;justify-content:center;align-items:center;min-height:100vh;font-family:'Segoe UI',sans-serif;color:#fff;touch-action:none;overflow:hidden}
#wrap{text-align:center}
h1{font-size:1.8rem;margin-bottom:8px;background:linear-gradient(90deg,#00f260,#0575e6);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
#score{font-size:1.2rem;margin-bottom:10px;color:#aaa}
#score span{color:#0f8;font-weight:bold;font-size:1.4rem}
canvas{border:2px solid #1a1a40;border-radius:8px;background:#1a1a2e;display:block;margin:0 auto;box-shadow:0 0 30px rgba(0,242,96,.15)}
#overlay{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;display:none}
#overlay h2{font-size:2rem;margin-bottom:12px;color:#f55}
#btn{margin-top:16px;padding:12px 32px;font-size:1.1rem;border:none;border-radius:25px;background:linear-gradient(135deg,#00f260,#0575e6);color:#fff;cursor:pointer;font-weight:bold;transition:transform .15s}
#btn:hover{transform:scale(1.05)}
#best{color:#888;font-size:.9rem;margin-top:6px}
</style>
</head>
<body>
<div id="wrap">
<h1>ğŸ è´ªåƒè›‡</h1>
<div id="score">åˆ†æ•°: <span id="sc">0</span></div>
<div style="position:relative;display:inline-block">
<canvas id="c"></canvas>
<div id="overlay"><h2 id="msg"></h2><div id="best"></div><button id="btn" onclick="init()">é‡æ–°å¼€å§‹</button></div>
</div>
</div>
<script>
const $=id=>document.getElementById(id),canvas=$('c'),ctx=canvas.getContext('2d');
let G=20,W,H,snake,dir,nextDir,food,score,best=+localStorage.getItem('snakeBest')||0,timer,alive;

function resize(){
  const s=Math.min(innerWidth-20,innerHeight-140,500);
  W=H=Math.floor(s/G)*G;canvas.width=canvas.height=W;
}

function init(){
  resize();
  const cols=W/G,mid=Math.floor(cols/2);
  snake=[{x:mid,y:mid},{x:mid-1,y:mid},{x:mid-2,y:mid}];
  dir=nextDir={x:1,y:0};score=0;alive=true;
  $('sc').textContent=0;$('overlay').style.display='none';
  placeFood();clearInterval(timer);timer=setInterval(tick,120);
}

function placeFood(){
  const cols=W/G,set=new Set(snake.map(s=>s.x+','+s.y));
  do{food={x:Math.random()*cols|0,y:Math.random()*cols|0}}while(set.has(food.x+','+food.y));
}

function tick(){
  dir=nextDir;
  const h={x:snake[0].x+dir.x,y:snake[0].y+dir.y},cols=W/G;
  if(h.x<0||h.y<0||h.x>=cols||h.y>=cols||snake.some(s=>s.x===h.x&&s.y===h.y))return die();
  snake.unshift(h);
  if(h.x===food.x&&h.y===food.y){score+=10;$('sc').textContent=score;placeFood()}else snake.pop();
  draw();
}

function draw(){
  ctx.clearRect(0,0,W,H);
  // grid
  ctx.strokeStyle='#1f1f3a';ctx.lineWidth=.5;
  for(let i=0;i<=W;i+=G){ctx.beginPath();ctx.moveTo(i,0);ctx.lineTo(i,H);ctx.stroke();ctx.beginPath();ctx.moveTo(0,i);ctx.lineTo(W,i);ctx.stroke()}
  // food
  ctx.fillStyle='#f55';ctx.beginPath();ctx.arc(food.x*G+G/2,food.y*G+G/2,G/2-2,0,Math.PI*2);ctx.fill();
  // snake
  snake.forEach((s,i)=>{
    const r=G/2-1,cx=s.x*G+G/2,cy=s.y*G+G/2;
    ctx.fillStyle=i===0?'#0f8':`hsl(145,80%,${55-Math.min(i,20)}%)`;
    ctx.beginPath();ctx.roundRect(s.x*G+1,s.y*G+1,G-2,G-2,4);ctx.fill();
  });
}

function die(){
  alive=false;clearInterval(timer);
  if(score>best){best=score;localStorage.setItem('snakeBest',best)}
  $('msg').textContent='æ¸¸æˆç»“æŸ';
  $('best').textContent='æœ€é«˜åˆ†: '+best;
  $('overlay').style.display='block';
}

// keyboard
document.addEventListener('keydown',e=>{
  const map={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};
  const d=map[e.key];if(d&&(d.x+dir.x||d.y+dir.y)){nextDir=d;e.preventDefault()}
});

// touch
let tx,ty;
canvas.addEventListener('touchstart',e=>{const t=e.touches[0];tx=t.clientX;ty=t.clientY;e.preventDefault()},{passive:false});
canvas.addEventListener('touchend',e=>{
  const t=e.changedTouches[0],dx=t.clientX-tx,dy=t.clientY-ty;
  if(Math.abs(dx)+Math.abs(dy)<20)return;
  const d=Math.abs(dx)>Math.abs(dy)?{x:dx>0?1:-1,y:0}:{x:0,y:dy>0?1:-1};
  if(d.x+dir.x||d.y+dir.y)nextDir=d;
},{passive:false});

init();
</script>
</body>
</html>
